<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Select Vendor</title>
    <link rel="stylesheet" href="styles.css"> <!-- Add your CSS file -->
</head>
<body>
    <h1>Vendor Selection</h1>

    <!-- Device Specifications -->
    <div id="device-specs">
        <h2>Your Selected Device</h2>
        <img id="spec-image" src="" alt="Selected Device Image" style="width: 200px; height: auto;"> 
        <p><strong>Device:</strong> <span id="spec-device"></span></p>
        <p><strong>Screen Size:</strong> <span id="spec-screenSize"></span></p>
        <p><strong>Processor:</strong> <span id="spec-processor"></span></p>
        <p><strong>RAM:</strong> <span id="spec-ram"></span></p>
        <p><strong>Storage:</strong> <span id="spec-storage"></span></p>
        <p><strong>Operating System:</strong> <span id="spec-os"></span></p>
    </div>

    <!-- Vendor List -->
    <div id="vendor-list">
        <h2>Available Vendors</h2>
        <ul id="vendors"></ul>
    </div>

    <!-- Selected Vendor Details -->
    <div id="vendor-details">
        <h2>Selected Vendor</h2>
        <img id="vendor-image" src="" alt="Vendor Image" width="150">
        <p><strong>Name:</strong> <span id="vendor-name"></span></p>
        <p><strong>Location:</strong> <span id="vendor-location"></span></p>
        <p><strong>Price:</strong> <span id="vendor-price"></span></p>
        <p><strong>About:</strong> <span id="vendor-about"></span></p>
        <h3>Reviews:</h3>
        <ul id="vendor-reviews"></ul> <!-- Added missing review list -->
    </div>

    <!-- Proceed Button -->
    <button id="proceed-button">Proceed to Cart</button>

    <script>
        document.addEventListener("DOMContentLoaded", async function () {
            console.log("Checking localStorage:", localStorage.getItem("selectedSpecs"));

            const selectedSpecs = JSON.parse(localStorage.getItem("selectedSpecs"));

            if (!selectedSpecs) {
                alert("⚠️ No device selected! Redirecting...");
                window.location.href = "Build.html";
                return;
            }

            // Display selected device specifications
            document.getElementById("spec-device").textContent = selectedSpecs.device || "Not selected";
            document.getElementById("spec-screenSize").textContent = selectedSpecs.screenSize || "Not selected";
            document.getElementById("spec-processor").textContent = selectedSpecs.processor || "Not selected";
            document.getElementById("spec-ram").textContent = selectedSpecs.ram || "Not selected";
            document.getElementById("spec-storage").textContent = selectedSpecs.storage || "Not selected";
            document.getElementById("spec-os").textContent = selectedSpecs.os || "Not selected";

            // Device images from Build.html
            const deviceImages = {
                computer: '../img/coding.png',
                smartphone: '../img/phone.png',
                tablet: '../img/ipad.png',
            };

            // Display selected device image
            document.getElementById("spec-image").src = deviceImages[selectedSpecs.device] || "";
            document.getElementById("spec-image").alt = selectedSpecs.device + " Image";

            // Fetch vendors from backend
            try {
                const response = await fetch("/getVendors");
                const vendors = await response.json();

                const vendorList = document.getElementById("vendors");
                vendors.forEach((vendor) => {
                    const li = document.createElement("li");
                    li.textContent = `${vendor.name} - ₹${vendor.price}`;
                    li.addEventListener("click", () => showVendorDetails(vendor));
                    vendorList.appendChild(li);
                });
            } catch (error) {
                console.error("Error fetching vendors:", error);
            }
        });

        function showVendorDetails(vendor) {
            document.getElementById("vendor-name").textContent = vendor.name;
            document.getElementById("vendor-location").textContent = vendor.address;
            document.getElementById("vendor-price").textContent = `₹${vendor.price}`;
            document.getElementById("vendor-about").textContent = vendor.about;
            document.getElementById("vendor-image").src = vendor.image || "default.jpg";

            const reviewsList = document.getElementById("vendor-reviews");
            reviewsList.innerHTML = ""; // Clear previous reviews
            vendor.reviews.forEach((review) => {
                const li = document.createElement("li");
                li.textContent = review;
                reviewsList.appendChild(li);
            });
        }

        document.getElementById("proceed-button").addEventListener("click", () => {
            const selectedVendor = {
                name: document.getElementById("vendor-name").textContent,
                image: document.getElementById("vendor-image").src,
                price: document.getElementById("vendor-price").textContent,
                address: document.getElementById("vendor-location").textContent
            };

            localStorage.setItem("selectedVendor", JSON.stringify(selectedVendor));
            window.location.href = "cart.html";
        });
    </script>
</body>
</html>
